<div class="container">
  <div class="row">
    <div class="col-12 mb-4">
      <h2 class="mb-4 text-center">Expenses Planner</h2>
      <!-- Budget Setting Section -->
      <div class="form-group d-flex">
        <label for="month" class="mr-3">Month:</label>
        <select id="month" name="month" [(ngModel)]="selectedMonth" required class="form-control flex-grow-1 mr-3">
          <option *ngFor="let month of months" [value]="month">{{ month }}</option>
        </select>
        <label for="initialBudget" class="mr-3">Initial Budget:</label>
        <input id="initialBudget" name="initialBudget" [(ngModel)]="initialBudget" required type="number"
          class="form-control flex-grow-1">
        <button type="submit" class="btn btn-primary ml-3" (click)="setBudget()">Set Budget</button>
      </div>
      <!-- Display budget information if set -->
      <div *ngIf="budgetSet">
        <hr>
        <p>Selected Month: {{ selectedMonth }}</p>
        <p>Initial Budget: {{ initialBudget | currency:'PHP':'symbol':'1.2-2' }}</p>
      </div>
    </div>
  </div>
  <div class="row">
    <!-- Income Form Container -->
    <div class="card">
      <div class="card-body">
        <h2 class="mb-4">Income</h2>
        <div class="form-group row">
          <div class="col-sm-4">
            <label for="incomeDescription">Description</label>
            <input id="incomeDescription" name="description" [(ngModel)]="newIncome.description" required type="text"
              class="form-control">
          </div>
          <div class="col-sm-4">
            <label for="incomeDate">Date:</label>
            <input id="incomeDate" name="date" [(ngModel)]="newIncome.date" required type="date" class="form-control">
          </div>
          <div class="col-sm-4">
            <label for="incomeAmount">Amount:</label>
            <input id="incomeAmount" name="amount" [(ngModel)]="newIncome.amount" required type="number"
              class="form-control">
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <button type="button" class="btn btn-primary float-right" (click)="addIncome()">Add Income</button>
          </div>
        </div>
        <!-- Total Income Display -->
        <div class="mt-4">
          <h3>Total Income: {{ totalIncome() | currency:'PHP':'symbol':'1.2-2' }}</h3>
        </div>
        <!-- Income Table -->
        <div class="table-responsive mt-4">
          <table mat-table [dataSource]="dataSourceIncome" class="mat-elevation-z8">
            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef> Description </th>
              <td mat-cell *matCellDef="let income"> {{ income.description }} </td>
            </ng-container>
            <!-- Date Column -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef> Date </th>
              <td mat-cell *matCellDef="let income"> {{ income.date }} </td>
            </ng-container>
            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef> Amount </th>
              <td mat-cell *matCellDef="let income"> {{ income.amount | currency:'PHP':'symbol':'1.2-2' }} </td>
            </ng-container>
            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let income; let i = index">
                <button type="button" class="btn btn-sm btn-info" (click)="editIncome(i)">Edit</button>
                <button type="button" class="btn btn-sm btn-danger" (click)="deleteIncome(i)">Delete</button>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['description', 'date', 'amount', 'actions']"></tr>
            <tr mat-row *matRowDef="let income; columns: ['description', 'date', 'amount', 'actions'];"></tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- Expense Form Container -->
  <div class="row">
    <div class="card">
      <div class="card-body">
        <h2 class="mb-4">Expenses</h2>
        <div class="form-group row">
          <div class="col-sm-4">
            <label for="expenseDescription">Description</label>
            <input id="expenseDescription" name="description" [(ngModel)]="newExpense.description" required type="text"
              class="form-control">
          </div>
          <div class="col-sm-4">
            <label for="expenseDate">Date:</label>
            <input id="expenseDate" name="date" [(ngModel)]="newExpense.date" required type="date" class="form-control">
          </div>
          <div class="col-sm-4">
            <label for="expenseAmount">Amount:</label>
            <input id="expenseAmount" name="amount" [(ngModel)]="newExpense.amount" required type="number"
              class="form-control">
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <button type="button" class="btn btn-primary float-right" (click)="addExpense()">Add Expense</button>
          </div>
        </div>
        <!-- Total Expenses Display -->
        <div class="mt-4">
          <h3>Total Expenses: {{ totalExpenses() | currency:'PHP':'symbol':'1.2-2' }}</h3>
        </div>
        <!-- Expense Table -->
        <div class="table-responsive mt-4">
          <table mat-table [dataSource]="dataSourceExpense" class="mat-elevation-z8">
            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef> Description </th>
              <td mat-cell *matCellDef="let expense"> {{ expense.description }} </td>
            </ng-container>
            <!-- Date Column -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef> Date </th>
              <td mat-cell *matCellDef="let expense"> {{ expense.date }} </td>
            </ng-container>
            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef> Amount </th>
              <td mat-cell *matCellDef="let expense"> {{ expense.amount | currency:'PHP':'symbol':'1.2-2' }} </td>
            </ng-container>
            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let expense; let i = index">
                <button type="button" class="btn btn-sm btn-info" (click)="editExpense(i)">Edit</button>
                <button type="button" class="btn btn-sm btn-danger" (click)="deleteExpense(i)">Delete</button>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['description', 'date', 'amount', 'actions']"></tr>
            <tr mat-row *matRowDef="let expense; columns: ['description', 'date', 'amount', 'actions'];"></tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h2 class="mb-4">Summary</h2>
          <table class="table">
            <thead>
              <tr>
                <th>Month</th>
                <th>Initial Budget</th>
                <th>Total Income</th>
                <th>Total Expenses</th>
                <th>Total Savings</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{ selectedMonth }}</td>
                <td>{{ initialBudget | currency:'PHP':'symbol':'1.2-2' }}</td>
                <td>{{ totalIncome() | currency:'PHP':'symbol':'1.2-2' }}</td>
                <td>{{ totalExpenses() | currency:'PHP':'symbol':'1.2-2' }}</td>
                <td>{{ totalSavings() | currency:'PHP':'symbol':'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
          <!-- Save Plan button -->
          <button type="button" class="btn btn-primary" (click)="savePlan()">Save Plan</button>
          <!-- Create New Plan button -->
          <button type="button" class="btn btn-secondary" (click)="createNewPlan()">Create New Plan</button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Adjust row spacing */
.row {
  margin-bottom: 20px;
}

/* Set card width to fill entire row */
.card {
  width: 100%;
}

/* Adjust card margin and padding */
.card {
  margin-bottom: 20px;
}

/* Ensure tables don't overflow */
.table-responsive {
  overflow-x: auto;
}

/* Ensure tables take full width */
.mat-elevation-z8 {
  width: 100%;
}

/* Adjust summary table width */
.table {
  width: 100%;
}

/* Ensure buttons are displayed inline */
.card-body button {
  display: inline-block;
  margin-right: 10px;
}

</style>